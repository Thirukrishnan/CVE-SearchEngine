import streamlit as st
import ir

st.set_page_config(page_title = "Search Engine") 
st.title("CVE Search Engine")

if "Searched" not in st.session_state:
	st.session_state.searched = False


if st.button("Search"):
	st.session_state.searched = True

if not st.session_state.searched:
	st.session_state.query = st.text_input("Open source project name")
	st.session_state.year_range = st.slider("Return CVE details dated between", 2000, 2023, (2000, 2023))
	st.session_state.count = st.text_input(" Enter the Number of results to display")

if st.session_state.searched:
	st.empty()

	result = ir.main(st.session_state.year_range, st.session_state.query, int(st.session_state.count))

	for entry in result:
		st.write("ID: ",entry['cve']['CVE_data_meta']['ID'])
		st.write(f"DATE :{entry['publishedDate']}")
		if 'baseMetricV3' in entry['impact']:
			st.write("IMPACT :")
			st.write(f"Base Score: {entry['impact']['baseMetricV3']['cvssV3']['baseScore']}")
			st.write(f"Severity: {entry['impact']['baseMetricV3']['cvssV3']['baseSeverity']}")
		st.write(f"DESC: {entry['cve']['description']['description_data'][0]['value']}")
		st.write("----------------------------------------------------------------------------")